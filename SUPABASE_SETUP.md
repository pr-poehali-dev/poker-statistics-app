# Настройка Supabase для Lozo Poker

## 1. Создание проекта Supabase

1. Перейдите на [supabase.com](https://supabase.com)
2. Создайте новый проект
3. Выберите регион (рекомендуется ближайший к вашим пользователям)
4. Дождитесь создания базы данных

## 2. Настройка базы данных

### Выполнение SQL схемы

1. Откройте SQL Editor в вашем проекте Supabase
2. Скопируйте содержимое файла `database/schema.sql`
3. Выполните SQL скрипт

### Проверка создания таблиц

Убедитесь, что созданы следующие таблицы:
- `players` - игроки
- `games` - игры
- `game_players` - связь игроков с играми
- `rounds` - раунды
- `round_winners` - победители раундов
- `buy_ins` - закупы
- `game_results` - результаты игр

## 3. Получение API ключей

1. Перейдите в Settings → API
2. Скопируйте:
   - `Project URL` (URL проекта)
   - `anon public` ключ

## 4. Настройка переменных окружения

Создайте файл `.env.local` в корне проекта:

```env
VITE_SUPABASE_URL=https://your-project-ref.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key-here
```

Замените:
- `your-project-ref` на реальный ID вашего проекта
- `your-anon-key-here` на реальный anon ключ

## 5. Настройка безопасности (опционально)

### Row Level Security (RLS)

В данной конфигурации RLS включен, но настроены политики для публичного доступа. Для продакшена рекомендуется:

1. Настроить аутентификацию
2. Создать более строгие политики безопасности
3. Ограничить доступ к данным по пользователям

### Пример более строгих политик:

```sql
-- Для авторизованных пользователей
CREATE POLICY "Users can view all data" ON players FOR SELECT USING (auth.role() = 'authenticated');
CREATE POLICY "Users can create players" ON players FOR INSERT WITH CHECK (auth.role() = 'authenticated');
```

## 6. Тестирование подключения

После настройки переменных окружения:

1. Запустите приложение: `npm run dev`
2. Проверьте консоль браузера на наличие ошибок подключения
3. Попробуйте создать игрока через интерфейс

## 7. Структура данных

### Основные таблицы:

**players** - информация об игроках
- id, name, статистика (игры, победы, процент побед)
- любимая комбинация, лучший дилер
- общая статистика закупов

**games** - игры
- настройки (блайнды, стартовый стек, курс)
- статус (active, finished, paused)
- время начала/окончания, длительность

**rounds** - раунды в играх
- связь с игрой, номер раунда
- дилер, комбинация, комментарий

**buy_ins** - закупы игроков
- количество фишек, сумма в рублях
- номер закупа для игрока

**game_results** - итоги игр
- финальные фишки, прибыль/убыток
- полная статистика по закупам

### Связи:

- Игра ↔ Игроки (многие-ко-многим через game_players)
- Раунд ↔ Победители (многие-ко-многим через round_winners)
- Все таблицы связаны через UUID ключи

## 8. Автоматические функции

### Обновление статистики игроков

Функция `update_player_stats(player_uuid)` автоматически пересчитывает:
- Общее количество игр
- Количество побед в раундах
- Процент побед
- Любимую комбинацию
- Лучшего дилера
- Статистику закупов

### Триггеры

- Автоматическое обновление `updated_at` при изменении записей
- Пересчет статистики всех игроков при завершении игры

## 9. Резервное копирование

Supabase автоматически создает резервные копии, но рекомендуется:

1. Настроить регулярные экспорты данных
2. Сохранить схему базы данных в системе контроля версий
3. Проверить возможность восстановления данных

## 10. Мониторинг

В панели Supabase можно отслеживать:
- Использование API
- Производительность запросов
- Логи ошибок
- Статистику использования

## Решение проблем

### Ошибка подключения
- Проверьте правильность URL и ключей
- Убедитесь, что переменные окружения загружены
- Проверьте доступность проекта Supabase

### Ошибки SQL
- Проверьте синтаксис в SQL Editor
- Убедитесь, что все таблицы созданы
- Проверьте логи в разделе Logs

### Проблемы с RLS
- Убедитесь, что политики настроены правильно
- Проверьте права доступа
- Временно отключите RLS для тестирования

## Контакты

При возникновении проблем с настройкой:
- Документация Supabase: https://supabase.com/docs
- Сообщество: https://github.com/supabase/supabase/discussions